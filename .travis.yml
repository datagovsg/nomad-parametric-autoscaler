
matrix:
  include:
    - language: go
      go: 1.11.x      
      script: 
        - go test -v ./...
    - language: node_js
      node_js: "10"
      before_install:
        - cd ui/
        - npm update
      install:
        - npm install
      script:
        - npm test

env:
  global:
  - IMAGE_NAME=${DOCKER_REGISTRY}/nomad-parametric-autoscaler
  - UI_IMAGE_NAME=${DOCKER_REGISTRY}/nomad-parametric-autoscaler-ui
  - GITHUB_USER=datagovsg
  - GITHUB_REPONAME=nomad-parametric-autoscaler

deploy:
  provider: releases
  skip_cleanup: true # Important, otherwise the build output would be purged.
  script:
    - docker build . -t ${IMAGE_NAME}:${TRAVIS_BRANCH}
    - docker login ${DOCKER_REGISTRY} -u="${DOCKER_USERNAME}" -p="${DOCKER_PASSWORD}"
    - docker push ${IMAGE_NAME}:${TRAVIS_BRANCH}
    - cd ui/
    - docker build . -t ${UI_IMAGE_NAME}:${TRAVIS_BRANCH}
    - docker push ${UI_IMAGE_NAME}:${TRAVIS_BRANCH}
  on:
    tags: true # The deployment happens only if the commit has a tag.
